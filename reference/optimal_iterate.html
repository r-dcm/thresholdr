<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Use iteration to estimate an optimal probability threshold when true
classifications are unknown."><title>Use iteration to estimate an optimal probability threshold — optimal_iterate • thresholdr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use iteration to estimate an optimal probability threshold — optimal_iterate"><meta property="og:description" content="Use iteration to estimate an optimal probability threshold when true
classifications are unknown."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">thresholdr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-dcm/thresholdr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Use iteration to estimate an optimal probability threshold</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-dcm/thresholdr/blob/HEAD/R/optimal-iterate.R" class="external-link"><code>R/optimal-iterate.R</code></a></small>
      <div class="d-none name"><code>optimal_iterate.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Use iteration to estimate an optimal probability threshold when true
classifications are unknown.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">optimal_iterate</span><span class="op">(</span></span>
<span>  <span class="va">estimates</span>,</span>
<span>  <span class="va">weighting_method</span>,</span>
<span>  <span class="va">optimal_method</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  additional_criterion <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  iter_burnin <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  iter_retain <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  comp_thresholds <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  metrics <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>estimates</dt>
<dd><p>A vector of probabilities.</p></dd>


<dt>weighting_method</dt>
<dd><p>The method for generating classifications, weighted
by the current estimate of the optimal threshold. One of
"beta", "distance".</p></dd>


<dt>optimal_method</dt>
<dd><p>The method for estimating the optimal threshold. One of
"youden", "topleft", "cz", "gmean".</p></dd>


<dt>...</dt>
<dd><p>Additional arguments passed to the corresponding weighting method.</p></dd>


<dt>additional_criterion</dt>
<dd><p>Optional. If provided, must be a class
probability metric from <a href="https://yardstick.tidymodels.org/reference/yardstick-package.html" class="external-link">yardstick</a>.</p></dd>


<dt>iter_burnin</dt>
<dd><p>The number of iterations to run and then discard (see
Details below).</p></dd>


<dt>iter_retain</dt>
<dd><p>The number of iterations to retain (see Details below).</p></dd>


<dt>comp_thresholds</dt>
<dd><p>Additional threshold values to evaluate against the
average optimal threshold (e.g., to compare the optimal threshold to a
competing threshold such as 0.5). If <code>NULL</code> (the default), no additional
thresholds are included in the performance evaluation.</p></dd>


<dt>metrics</dt>
<dd><p>Either <code>NULL</code> or a <code><a href="https://yardstick.tidymodels.org/reference/metric_set.html" class="external-link">yardstick::metric_set()</a></code> with a list of
performance metrics to calculate. The metrics should all be oriented
towards hard class predictions (e.g., <code><a href="https://yardstick.tidymodels.org/reference/sens.html" class="external-link">yardstick::sensitivity()</a></code>,
<code><a href="https://yardstick.tidymodels.org/reference/accuracy.html" class="external-link">yardstick::accuracy()</a></code>, <code><a href="https://yardstick.tidymodels.org/reference/recall.html" class="external-link">yardstick::recall()</a></code>) and not class
probabilities. A set of default metrics is used when <code>NULL</code> (see
<code><a href="https://probably.tidymodels.org/reference/threshold_perf.html" class="external-link">probably::threshold_perf()</a></code> for details).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A <a href="https://tibble.tidyverse.org/reference/tibble-package.html" class="external-link">tibble</a> with 1 row per threshold. The
columns are:</p><ul><li><p><code>.threshold</code>: The optimal threshold.</p></li>
<li><p>If <code>additional_criterion</code> was specified, an <a href="https://mc-stan.org/posterior/reference/rvar.html" class="external-link">rvar</a>
containing the distribution of class probability metrics across all
retained iterations.</p></li>
<li><p>A set of <a href="https://mc-stan.org/posterior/reference/rvar.html" class="external-link">rvar</a> objects for each of the specified
performance metrics, containing the distributions across all retained
iterations (i.e., 1 column per specified metric).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>To initialize the iteration process, a vector of "true" values is generated
using <code><a href="generate_truth.html">generate_truth()</a></code>. Then, the optimal threshold is calculated using the
set of generated "true" values and the specified <code>optimal_method</code>. A new
vector of "true" values is then generated, with classifications biased in the
direction of the calculated optimal threshold using the method specified by
<code>weighting_method</code>. That is, <code>estimates</code> will be less likely to result in a
classification 1 if the threshold is .8 than if it is .5. Using the updated
vector of "true" values, a new optimal threshold is calculated. This proceeds
for the specified number of iterations. The total number of iterations is
given by <code>iter_burnin + iter_retain</code>; however, the first <code>iter_burnin</code>
iterations are discarded. For example, if you specify 100 burn-in iterations
and 1,000 retained iterations, a total of 1,100 total iterations will be
completed, but results will be based only on the final 1,000 iterations.
The optimal threshold is then calculated as the average of the threshold
values from the retained iterations.</p>
<p>Convergence of the iteration process is monitored using the \(\hat{R}\)
statistic described by Vehtari et al. (2021). By default, the \(\hat{R}\)
statistic is calculated for the optimal threshold values that are estimated
at each iteration. Optionally, users may specify and <code>additional_criterion</code>
to be monitored with the \(\hat{R}\). For example, we could calculate the
area under the ROC curve with the "true" values used at each iteration to
monitor that value for convergence as well. A warning is produced if the
threshold or, if specified, the <code>additional_criterion</code> do not meet the
convergence criteria of an \(\hat{R}\) less than 1.01 recommended by
Vehtari et al. (2021).</p>
<p>Finally, the average threshold is applied to the samples of "true" values
that were generated at each iteration to calculate performance metrics for
each iteration (e.g., sensitivity, specificity). In addition, we can also
specify additional thresholds to compare (<code>comp_thresholds</code>) that may be of
interest (e.g., comparing our optimal threshold to the traditional threshold
of 0.5). Thus, the final returned object includes each of the investigated
thresholds (i.e., the optimal threshold and any specified in
<code>comp_thresholds</code>) and the distribution of the performance metrics across all
retained iterations for each of the thresholds. To change the metrics that
are provided by default, specify new <code>metrics</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Vehtari, A., Gelman, A., Simpson, D., Carpenter, B., &amp; Bürkner,
P.-C. (2021). Rank-normalization, folding, and localization: An improved
\(\hat{R}\) for assessing convergence of MCMC (with discussion).
<em>Bayesian Analysis, 16</em>(2), 667-718. <a href="https://doi.org/10.1214/20-BA1221" class="external-link">doi:10.1214/20-BA1221</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other threshold approximation methods: 
<code><a href="optimal_resample.html">optimal_resample</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">optimal_iterate</span><span class="op">(</span>estimates <span class="op">=</span> <span class="va">est</span>, weighting_method <span class="op">=</span> <span class="st">"distance"</span>,</span></span>
<span class="r-in"><span>                optimal_method <span class="op">=</span> <span class="st">"youden"</span>, iter_retain <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 1 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .threshold   sensitivity   specificity      j_index</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;rvar[1d]&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>      0.542  0.79 <span style="color: #949494;">± 0.047</span>  0.72 <span style="color: #949494;">± 0.061</span>  0.51 <span style="color: #949494;">± 0.07</span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by W. Jake Thompson, Jonathan A. Pedroza.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

